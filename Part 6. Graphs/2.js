const queue = require('../Part 4. Data structures/queue')

// Задание 2: Реализуйте функцию топологической сортировки графа, заданного в виде матрицы смежности.

// Для данного задания матрица смежности adjacencyMatrix из предыдущего задания не подойдёт,
// потому-что граф неупорядоченный (связи м/у узлами "двунаправленные") и содержит циклы.
// Хотя, я по началу думал, что просто импортирую adjacencyMatrix и использую тут.

// Шаги:
// 1. Представлю граф из презентации (в разд. Топологическая сортировка) в кач.ве матрицы смежности.
// 2. Реализую данную матрицу в кач-ве двумерного массива (массив массивов в js).
// 3. Реализую функцию топологической сортировки графа.

// Решение:
// 1. Матрица смежности:
//    [1][2][3][4][5][6]
// [1] 0  1  0  0  0  1
// [2] 0  0  0  0  0  0
// [3] 0  1  0  1  0  0
// [4] 1  1  0  0  1  0
// [5] 0  0  0  0  0  0
// [6] 0  0  0  0  1  0

// 2. Массив массивов в js:
const adjacencyMatrix2 = [
  [0, 1, 0, 0, 0, 1],
  [0, 0, 0, 0, 0, 0],
  [0, 1, 0, 1, 0, 0],
  [1, 1, 0, 0, 1, 0],
  [0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 1, 0],
]; 

// 3. Функция топологической сортировки графа:
function topologicalSort(matrix) {
  const numVertices = matrix.length;
  const inDegree = new Array(numVertices).fill(0);
  const result = [];

  // Вычисляем входящие степени для каждой вершины
  for (let i = 0; i < numVertices; i++) {
    for (let j = 0; j < numVertices; j++) {
      if (matrix[i][j] === 1) {
        inDegree[j]++;
      }
    }
  }

  // Добавляем вершины с нулевой степенью в очередь
  for (let i = 0; i < numVertices; i++) {
    if (inDegree[i] === 0) {
      queue.offer(i);
    }
  }

  // Обрабатываем очередь
  while (!queue.isEmpty()) {
    const u = queue.poll();
    result.push(u);

    // Уменьшаем степень смежных вершин
    for (let v = 0; v < numVertices; v++) {
      if (matrix[u][v] === 1) {
        inDegree[v]--;
        if (inDegree[v] === 0) {
          queue.offer(v);
        }
      }
    }
  }

  // Проверка на наличие цикла
  if (result.length !== numVertices) {
    return "Граф содержит цикл";
  }

  return result;
}

console.log(topologicalSort(adjacencyMatrix2));
/* 
  Вывод в консоли:
  [ 2, 3, 0, 1, 5, 4 ]

  >>> Топологическая сортировка выполнена. В результирующем массиве приведен порядок индексов вершин 
*/